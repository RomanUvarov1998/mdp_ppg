<UserControl x:Class="MDP_PPG.PagedViews.UC_SignalDataViewer"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:MDP_PPG.PagedViews"
             xmlns:gif="http://wpfanimatedgif.codeplex.com"
             xmlns:convs="clr-namespace:MDP_PPG.Converters"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800">

    <UserControl.Resources>

        <convs:Parent2ChildrenMessageConverter
            ChoseMessage="Выберите запись для просмотра сигнала" 
            EmptyMessage="Для данной записи нет внесенных сигнала" 
            x:Key="parent2MessageConverter"/>

        <Style TargetType="ContentControl" x:Key="infoContent">
            <Style.Triggers>
                <MultiDataTrigger>
                    <MultiDataTrigger.Conditions>
                        <Condition  Binding="{Binding IsLoadingData}" Value="False"/>
                        <Condition  Binding="{Binding Plot}" Value="{x:Null}"/>
                    </MultiDataTrigger.Conditions>
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="ContentControl">
                                <TextBlock Text="{Binding Recording, Converter={StaticResource parent2MessageConverter}}" 
                                           TextWrapping="Wrap"
                                           HorizontalAlignment="Center"
                                           VerticalAlignment="Center"/>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </MultiDataTrigger>
                <DataTrigger Binding="{Binding IsLoadingData}" Value="True">
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="ContentControl">
                                <Image Width="200" 
                                       gif:ImageBehavior.AnimatedSource="../Resources/loading.gif"
                                       gif:ImageBehavior.RepeatBehavior="Forever"/>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </DataTrigger>
            </Style.Triggers>
        </Style>
        
    </UserControl.Resources>

    <Grid>

        <Grid.RowDefinitions>
            <RowDefinition Height="auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <WrapPanel IsEnabled="{Binding IsInterfaceEnabled}">
            <TextBlock Text="Масштаб по времени"
                       Margin="3"/>
            <TextBox Text="{Binding Plot.SampleWidth, UpdateSourceTrigger=PropertyChanged}"
                     Width="30"
                     Margin="3,3,10,3"/>

            <TextBlock Text="Масштаб по величине"
                       Margin="3"/>
            <TextBox Text="{Binding Plot.Y_Scale, UpdateSourceTrigger=PropertyChanged}"
                     Width="30"
                     Margin="3,3,10,3"/>


            <TextBlock Text="{Binding SizeInfo}"
                       Margin="3"/>
        </WrapPanel>

        <ContentControl Style="{StaticResource infoContent}"
                        Grid.Row="1"
                        SnapsToDevicePixels="True">

            <ScrollViewer VerticalScrollBarVisibility="Visible">

                <Grid>

                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <Grid Background="White"
                          VerticalAlignment="Top">

                        <Path Data="{Binding Plot.Y_Axis}"
                              Stroke="Black"
                              StrokeThickness="2"/>

                    </Grid>

                    <ScrollViewer HorizontalScrollBarVisibility="Auto"
                                  VerticalScrollBarVisibility="Hidden"
                                  HorizontalAlignment="Stretch"
                                  VerticalAlignment="Top"
                                  Background="Gainsboro"
                                  PreviewMouseWheel="ScrollViewer_MouseWheel"
                                  Grid.Column="1">

                        <Grid Background="White"
                              VerticalAlignment="Center"
                              DataContext="{Binding Plot}">

                            <Polyline Points="{Binding PlotPoints}"
                                      Stroke="OrangeRed"
                                      StrokeThickness="3"/>

                            <Path Data="{Binding PlotGrid}" 
                                  Stroke="Gray" 
                                  StrokeThickness="1"/>

                            <Path Data="{Binding X_Axis}" 
                                  Stroke="Black" 
                                  StrokeThickness="2"/>

                        </Grid>

                    </ScrollViewer>

                </Grid>

            </ScrollViewer>

        </ContentControl>

    </Grid>
    
</UserControl>
